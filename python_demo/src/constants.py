import numpy as np
from src import utils
import copy

# ======================================================================
# 1. Level 1 Filters
# ======================================================================

# --- Tree Re (CDF) ---
_CDF_H0 =  np.array([
        0.03782845550726404,
        -0.023849465019556843,
        -0.11062440441843718,
         0.37740285561283066,
         0.85269867900889385,
         0.37740285561283066,
        -0.11062440441843718,
        -0.023849465019556843,
         0.03782845550726404
    ])

_CDF_H1 =  np.array([
-0.06453888262869706,
         0.04068941760916406,
         0.41809227322161724,
        -0.7884856164055829,
         0.41809227322161724,
         0.04068941760916406,
        -0.06453888262869706
         ])

_CDF_G0 =  np.array([
-0.06453888262869706,
        -0.04068941760916406,
         0.41809227322161724,
         0.7884856164055829,
         0.41809227322161724,
        -0.04068941760916406,
        -0.06453888262869706
         ])

_CDF_G1 =  np.array([
-0.03782845550726404,
        -0.023849465019556843,
         0.11062440441843718,
         0.37740285561283066,
        -0.85269867900889385,
         0.37740285561283066,
         0.11062440441843718,
        -0.023849465019556843,
        -0.03782845550726404
         ])

# Analysis Filters
CDF_H0R = np.r_[_CDF_H0, 0.0]
CDF_H1R = np.r_[_CDF_H1, 0.0]

# Synthesis Filters (Time Reverse for Orthogonal Wavelets)
CDF_G0R = np.r_[0.0, _CDF_G0]
CDF_G1R = np.r_[0.0, _CDF_G1]

# Delay
CDF_D0R = 8
CDF_D1R = 8

CDF_RE = utils.SingleTreeFilterBank(
  analysis_low=CDF_H0R,
  analysis_high=CDF_H1R,
  synthesis_low=CDF_G0R,
  synthesis_high=CDF_G1R,
  delay_low=CDF_D0R,
  delay_high=CDF_D1R
)

# --- Tree Im (1-Sample Delayed Version) ---
# Analysis Filters: 先頭に0を追加して遅延させる (z^-1)
CDF_H0I = np.r_[0.0, _CDF_H0]
CDF_H1I = np.r_[0.0, _CDF_H1]

# Synthesis Filters
CDF_G0I = np.r_[_CDF_G0, 0.0]
CDF_G1I = np.r_[_CDF_G1, 0.0]

# Delay
CDF_D0I = 8
CDF_D1I = 8

CDF_IM = utils.SingleTreeFilterBank(
  analysis_low=CDF_H0I,
  analysis_high=CDF_H1I,
  synthesis_low=CDF_G0I,
  synthesis_high=CDF_G1I,
  delay_low=CDF_D0I,
  delay_high=CDF_D1I
)

# ======================================================================
# 2. Level >= 2 Filters: Kingsbury Q-Shift 14-tap
# ======================================================================
# 14-tap係数 (qshift_b)

# --- Tree Re (Basic Q-Shift) ---
# Analysis
QSHIFT14_H0R = np.array([
     0.0032531427636532, -0.0038832119991585,  0.0346603468448535, -0.0388728012688278, 
    -0.1172038876991153,  0.2752953846688820,  0.7561456438925225,  0.5688104207121227, 
     0.0118660920337970, -0.1067118046866654,  0.0238253847949203,  0.0170252238815540, 
    -0.0054394759372741, -0.0045568956284755, 
])
QSHIFT14_H1R = np.array([
    -0.0045568956284755,  0.0054394759372741,  0.0170252238815540, -0.0238253847949203,
    -0.1067118046866654, -0.0118660920337970,  0.5688104207121227, -0.7561456438925225,
     0.2752953846688820,  0.1172038876991153, -0.0388728012688278, -0.0346603468448535,
    -0.0038832119991585, -0.0032531427636532,
])

# Synthesis
QSHIFT14_G0R = np.array([
    -0.0045568956284755, -0.0054394759372741,  0.0170252238815540,  0.0238253847949203,
    -0.1067118046866654,  0.0118660920337970,  0.5688104207121227,  0.7561456438925225,
     0.2752953846688820, -0.1172038876991153, -0.0388728012688278,  0.0346603468448535,
    -0.0038832119991585,  0.0032531427636532,
])
QSHIFT14_G1R = np.array([
    -0.0032531427636532, -0.0038832119991585, -0.0346603468448535, -0.0388728012688278,
     0.1172038876991153,  0.2752953846688820, -0.7561456438925225,  0.5688104207121227,
    -0.0118660920337970, -0.1067118046866654, -0.0238253847949203,  0.0170252238815540,
     0.0054394759372741, -0.0045568956284755,
])

# Delay
QSHIFT14_D0R = 13
QSHIFT14_D1R = 13

QSHIFT14_RE = utils.SingleTreeFilterBank(
  analysis_low=QSHIFT14_H0R,
  analysis_high=QSHIFT14_H1R,
  synthesis_low=QSHIFT14_G0R,
  synthesis_high=QSHIFT14_G1R,
  delay_low=QSHIFT14_D0R,
  delay_high=QSHIFT14_D1R
)


# --- Tree Im (Time-Reverse of Tree Re) ---
QSHIFT14_H0I = np.array([
    -0.0045568956284755, -0.0054394759372741,  0.0170252238815540,  0.0238253847949203,
    -0.1067118046866654,  0.0118660920337970,  0.5688104207121227,  0.7561456438925225,
     0.2752953846688820, -0.1172038876991153, -0.0388728012688278,  0.0346603468448535,
    -0.0038832119991585,  0.0032531427636532,
])
QSHIFT14_H1I = np.array([
    -0.0032531427636532, -0.0038832119991585, -0.0346603468448535, -0.0388728012688278,
     0.1172038876991153,  0.2752953846688820, -0.7561456438925225,  0.5688104207121227,
    -0.0118660920337970, -0.1067118046866654, -0.0238253847949203,  0.0170252238815540,
     0.0054394759372741, -0.0045568956284755,
])

# Tree Im Synthesis
QSHIFT14_G0I = np.array([
     0.0032531427636532, -0.0038832119991585,  0.0346603468448535, -0.0388728012688278,
    -0.1172038876991153,  0.2752953846688820,  0.7561456438925225,  0.5688104207121227,
     0.0118660920337970, -0.1067118046866654,  0.0238253847949203,  0.0170252238815540,
    -0.0054394759372741, -0.0045568956284755,
])
QSHIFT14_G1I = np.array([
    -0.0045568956284755,  0.0054394759372741,  0.0170252238815540, -0.0238253847949203,
    -0.1067118046866654, -0.0118660920337970,  0.5688104207121227, -0.7561456438925225,
     0.2752953846688820,  0.1172038876991153, -0.0388728012688278, -0.0346603468448535,
    -0.0038832119991585, -0.0032531427636532,
])

# Delay
QSHIFT14_D0I = 13
QSHIFT14_D1I = 13

QSHIFT14_IM = utils.SingleTreeFilterBank(
  analysis_low=QSHIFT14_H0I,
  analysis_high=QSHIFT14_H1I,
  synthesis_low=QSHIFT14_G0I,
  synthesis_high=QSHIFT14_G1I,
  delay_low=QSHIFT14_D0I,
  delay_high=QSHIFT14_D1I
)


# ======================================================================
# 3. Packet Extension Filters
# ======================================================================
# 論文 dtcwpt.pdf (Bayram & Selesnick) の Theorem 1 に基づき、
# パケット分解でヒルベルト対を維持するためには、Tree Re と Tree Im で
# 「同一のフィルタ」を使用する必要があります。
# したがって、Tree Im 用 (Packet Tree Im) にも Tree Re のフィルタを適用します。

PACKET_H0 = copy.deepcopy(QSHIFT14_H0R)
PACKET_H1 = copy.deepcopy(QSHIFT14_H1R)
PACKET_G0 = copy.deepcopy(QSHIFT14_G0R)
PACKET_G1 = copy.deepcopy(QSHIFT14_G1R)

# Delay
PACKET_D0 = 13
PACKET_D1 = 13

PACKET_RE = utils.SingleTreeFilterBank(
  analysis_low=PACKET_H0,
  analysis_high=PACKET_H1,
  synthesis_low=PACKET_G0,
  synthesis_high=PACKET_G1,
  delay_low=PACKET_D0,
  delay_high=PACKET_D1
)

PACKET_IM = utils.SingleTreeFilterBank(
  analysis_low=PACKET_H0,
  analysis_high=PACKET_H1,
  synthesis_low=PACKET_G0,
  synthesis_high=PACKET_G1,
  delay_low=PACKET_D0,
  delay_high=PACKET_D1
)